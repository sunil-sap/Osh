<?xml version="1.0" encoding="utf-8"?>
<process xmlns="http://www.hybris.de/xsd/processdefinition" start="receiveConsignmentStatus" name="successfulShipmentEmailProcess" processClass="de.hybris.platform.ordersplitting.model.ConsignmentProcessModel">

	<!-- <action id="waitBeforeTransmission" bean="waitBeforeTransmission">
		<transition name="NOK" to="waitBeforeTransmission"/>
		<transition name="OK" to="sendConsignmentToWarehouse"/>
	</action>

	<action id="sendConsignmentToWarehouse" bean="sendConsignmentToWarehouse">
		<transition name="OK" to="waitForWarehouse"/>
	</action>

	 <wait id="waitForWarehouse" then="receiveConsignmentStatus" prependProcessCode="false">
		<event>${process.code}_WaitForWarehouse</event>
	</wait>  -->
	
	  <action id="receiveConsignmentStatus" bean="receiveConsignmentStatus">
		<transition name="OK" to="takePayment"/>
		<transition name="PARTIAL" to="calculatePayment"/>
		 <transition name="CANCEL" to="cancelConsignment"/>
		<transition name="ERROR" to="error"/>
	</action>
	<action id="calculatePayment" bean="calculatePayment">
		<transition name="OK" to="takePayment"/>
	</action>
	 
	 
	<action id="takePayment" bean="takePayment">
		<transition name="OK" to="allowShipment"/>
		<transition name="NOK" to="failed"/>
	</action>
	
	 <action id="allowShipment" bean="allowShipment">
		<transition name="OK" to="sendDeliveryMessage"/>
	</action>
	<action id="sendDeliveryMessage" bean="sendDeliveryMessage">
		<transition name="OK" to="subprocessEnd"/>
	</action>

	<action id="sendPaymentFailedMessage" bean="sendPaymentFailedMessage">
		<transition name="OK" to="subprocessEnd"/>
	</action>

	<action id="cancelConsignment" bean="cancelConsignment">
		<transition name="OK" to="sendCancelMessage"/>
	</action>

	<action id="sendCancelMessage" bean="sendCancelMessage">
		<transition name="OK" to="generateSuccessfulShipmentEmail"/>
	</action>
		
	<action id="generateSuccessfulShipmentEmail" bean="generateSuccessfulShipmentEmail">
		<transition name="NOK" to="failed"/>
		<transition name="OK" to="subprocessEnd"/>
	</action>
	<action id="subprocessEnd" bean="subprocessEnd">
		<transition name="OK" to="success"/>
	</action> 



	<end id="error" state="ERROR">All went wrong.</end>
	<end id="failed" state="FAILED">Order not placed.</end>
	<end id="success" state="SUCCEEDED">Order placed.</end>
</process>